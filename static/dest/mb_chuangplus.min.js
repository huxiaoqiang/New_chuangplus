/* chuangplus2015-10-30 */
var app=angular.module("chuangplus_mobile",["ngRoute","ngTouch","ngCookies","mobile-angular-ui","mobile-angular-ui.gestures","chuangplus_mobile.filters","chuangplus_mobile.services","chuangplus_mobile.directives","chuangplus_mobile.controllers"]).constant("urls",{part_mobile:"/static/partials/mobile",part_desktop:"/static/partials/desktop",part_admin:"/static/partials/admin",api:"/api",mobile_index:"/mobile/index"}).config(["$interpolateProvider",function(a){a.startSymbol("[["),a.endSymbol("]]")}]).config(["$httpProvider",function(a){a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded"}]).config(["$routeProvider","$locationProvider","urls",function(a,b,c){b.html5Mode(!0),b.hashPrefix="",a.when("/mobile/index",{templateUrl:c.part_mobile+"/company/list.html",title:"公司列表"}),a.when("/mobile/test",{templateUrl:c.part_mobile+"/test.html",title:"公司列表"}),a.when("/mobile/notlogin",{templateUrl:c.part_mobile+"/notlogin.html",title:"未登录"}),a.when("/mobile/register",{templateUrl:c.part_mobile+"/register.html",title:"注册"}),a.when("/mobile/login",{templateUrl:c.part_mobile+"/login.html",title:"登录"}),a.when("/mobile/info",{templateUrl:c.part_mobile+"/info.html",title:"基本信息填写"}),a.when("/mobile/position/list",{templateUrl:c.part_mobile+"/position/list.html",title:"职位列表"}),a.when("/mobile/position/import",{templateUrl:c.part_mobile+"/position/import.html",title:"职位导入"}),a.when("/mobile/position/detail",{templateUrl:c.part_mobile+"/position/detail.html",title:"职位详情"}),a.when("/mobile/position/collect",{templateUrl:c.part_mobile+"/position/collect.html",title:"职位收藏列表"}),a.when("/mobile/company/detail",{templateUrl:c.part_mobile+"/company/detail.html",title:"公司详情"}),a.when("/mobile/company/posi/:company_id",{templateUrl:c.part_mobile+"/company/posi.html",title:"公司所有职位"}),a.when("/mobile/company/collect",{templateUrl:c.part_mobile+"/company/collect.html",title:"公司收藏列表"}),a.when("/mobile/home/infoupdate",{templateUrl:c.part_mobile+"/home/infoupdate.html",title:"更新用户信息"}),a.when("/mobile/home/editresume/:position_id",{templateUrl:c.part_mobile+"/home/editresume.html",title:"编辑简历"}),a.when("/mobile/home/editresume/",{templateUrl:c.part_mobile+"/home/editresume.html",title:"编辑简历"}),a.when("/mobile/home/uploadresume",{templateUrl:c.part_mobile+"/home/uploadresume.html",title:"上传简历"}),a.when("/mobile/home",{templateUrl:c.part_mobile+"/home/pcenter.html",title:"个人中心"}),a.when("/mobile/home/mypost",{templateUrl:c.part_mobile+"/home/mypost.html",title:"我的投递"}),a.otherwise({redirectTo:"/"})}]);app.run(["$rootScope","$location","UserService",function(a,b,c){a.$on("$routeChangeSuccess",function(b,c,d){a.title=c.$$route.title}),a.$on("$routeChangeStart",function(){a.is_login=c.is_login();a.loading=!0})}]),angular.module("chuangplus_mobile.services",["chuangplus_mobile.services"]).value("version","0.1").service("CsrfService",["$cookies",function(a){return{val:function(){return a.csrftoken},set_csrf:function(b){b.csrfmiddlewaretoken=a.csrftoken},set_csrf_array:function(b){b.push({csrfmiddlewaretoken:a.csrftoken})}}}]).service("NoticeService",["$cookies",function(a){return $(".notice-bar").html("欢迎来到犀牛"),{show:function(a){$(".notice-bar").html(a),$(".notice-bar").slideDown("fast"),setTimeout(function(){$(".notice-bar").slideUp("fast")},1800)}}}]).service("ErrorService",["$cookies",function(a){var b={code15:"文件大小超过10M",code18:"没有上传文件权限",code19:"上传文件为空",code20:"要下载的文件不存在",code30:"没有删除文件的权限",code31:"文件不存在，删除失败",code98:"验证码已经失效，请刷新验证码重试",code99:"需要验证码",code100:"没有权限 ",code101:"验证码错误",code103:"用户不存在",code104:"用户信息不存在",code105:"公司信息不存在",code106:"注册失败",code107:"用户名已存在或用户名包含特殊字符",code108:"用户名或密码错误",code109:"新旧密码一样",code110:"没有修改权限",code112:"公司成员不存在",code113:"您是hr，请到hr页面登录",code114:"您是实习生，请到实习生页面登录",code115:"邮箱已经被注册",code116:"邮箱格式不正确",code117:"密码错误",code120:"简历不存在",code121:"融资信息不存在",code210:"职位名太长或者太短",code211:"职位名中包含非法字符",code212:"非法的职位类别",code213:"工作城市字数长度过长或过短",code214:"工作城市中包含非法字符",code215:"工作地址字数长度过长或过短",code216:"工作地址中包含非法字符",code217:"非法的时间形式",code218:"截止时间不能早于发布时间",code219:"职位描述长度超出限度",code220:"职位描述包含非法字符",code221:"职位要求长度超出限度 ",code222:"职位描述中包含非法字符 ",code223:"每周工作时间选择错误，在1到7之间 ",code224:"实习时间错误，应该是一个非负整数 ",code225:"薪资最低值填写错误",code226:"薪资最高值填写错误",code227:"薪资上限应该大于薪酬下限",code228:"职位状态错误",code231:"错误的搜索值：id",code232:"错误的搜索值：城市",code233:"错误的搜索值：每周至少工作的天数",code234:"错误的搜索值：每周最多工作的天数",code235:"错误的搜索值：最低薪资",code236:"错误的搜索值：最高薪资",code237:"错误的搜索值：职位状态",code249:"对象不存在",code250:"存储失败",code251:"搜索失败",code252:"删除失败",code260:"职位不存在",code261:"关注关系不存在，不能取消关注",code262:"职位只能是兼职或全职",code263:"关注公司关系不存在",code264:"用户未投递该职位",code265:"用户未投递任何职位",code266:"已经投递了该职位",code267:"没有实习生投递该职位",code268:"没有岗位消息要处理",code269:"邀请码错误，请联系创加获取邀请码",code270:"邮箱验证码错误",code271:"邮箱验证码失效，请重新发送邮箱验证码",code272:"登录错误",code273:"您的info用户名已经被注册，请去普通登录页登录",code299:"未知错误"};return{format_error:function(a,c){return""!=a&&1==c.code?(c.message=a,c["class"]="alert alert-success"):(c["class"]="alert alert-danger",c.message=a,-1!=c.code&&(c.code_key="code"+c.code,c.message=b[c.code_key])),c.show=!0,c},remove_error:function(a){a.show=!1}}}]).service("UserService",["urls","$http","$cookies","$location","$rootScope",function(a,b,c,d,e){var f={};return c.username&&(f.username=c.username),c.id&&(f.id=c.id),c.role&&(f.role=c.role),{check_info:function(){void 0!=f.username&&b.get(a.api+"/account/userinfo/get").success(function(a){1==a.error.code?(e.is_tsinghua=a.data.is_info,(void 0==a.data.major||void 0==a.data.university||void 0==a.data.grade||e.is_tsinghua&&void 0==a.data.email)&&(console.log("需要填写信息"),window.location.href="/mobile/info")):$notice.show($errMsg.format_error("",a.error).message)})},check_login:function(){return void 0==f.username?void(window.location.href="/mobile/login"):void b.get(a.api+"/account/userinfo/get").success(function(a){1==a.error.code?(void 0==a.data.major||void 0==a.data.university)&&(console.log("需要填写信息"),window.location.href="/mobile/info"):$notice.show($errMsg.format_error("",a.error).message)})},is_login:function(){return void 0!=f.username},username:function(){return f.username},refresh:function(){$.get(a.api+"/user/status",function(a){f=a})},id:function(){return f.id},role:function(){return f.role},school_manager:function(){return"role"in f?0==parseInt(f.role)||4==parseInt(f.role):!1},department_manager:function(){return"role"in f?0==parseInt(f.role)||3==parseInt(f.role):!1},logout:function(){$.cookie("username","",{path:"/"}),$.cookie("role","",{path:"/"})}}}]).factory("safeApply",["$rootScope",function(a){return function(a,b){var c=a.$root.$$phase;"$apply"==c||"$digest"==c?b&&"function"==typeof b&&b():a.$apply(b)}}]),angular.module("chuangplus_mobile.filters",[]).filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}]).filter("id2date",function(){return function(a){var b=1e3*parseInt(a.substring(0,8),16),c=new Date(b);return c.getFullYear()+"年"+(c.getMonth()+1)+"月"+c.getDate()+"日"}}),angular.module("chuangplus_mobile.directives",[]).directive("appVersion",["version",function(a){return function(b,c,d){c.text(a)}}]).directive("onFinishRenderFilters",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){b.$last===!0&&a(function(){b.$emit("ngRepeatFinished")})}}}]).directive("onBlur",["safeApply",function(a){return{restrict:"A",link:function(b,c,d){c.bind("blur",function(){a(b,d.onBlur)})}}}]).directive("onFocus",["safeApply",function(a){return{restrict:"A",link:function(b,c,d){c.bind("focus",function(){a(b,d.onFocus)})}}}]).directive("onMouseover",["safeApply",function(a){return{restrict:"A",link:function(b,c,d){c.bind("mouseover",function(){a(b,d.onMouseover)})}}}]).directive("onMouseout",["safeApply",function(a){return{restrict:"A",link:function(b,c,d){c.bind("mouseout",function(){a(b,d.onMouseout)})}}}]).directive("myText",function(){return{restrict:"E",scope:{text:"="},replace:!0,templateUrl:"/static/partials/desktop/directive_templates/myText.html",link:function(a,b,c){a.$watch("text",function(c){if(void 0!=c){a.texts=c.split("\n");Date.parse(new Date);b.children()!=[]&&b.empty();for(var d=0;d<a.texts.length;d++)""!=a.texts[d]?b.append("<li>"+a.texts[d]+"</li>"):b.append("</br>")}})}}}).directive("page",function(){return{restrict:"E",scope:{numPages:"=",currentPage:"=",onSelectPage:"&"},replace:!0,templateUrl:"/static/partials/desktop/directive_templates/pagination.html",link:function(a){a.$watch("numPages",function(b){a.pages=[];for(var c=1;b>=c;c++)a.pages.push(c);a.currentPage>b&&a.selectPage(b)}),a.isActive=function(b){return a.currentPage==b},a.selectPage=function(b){a.isActive(b)||(a.currentPage=b,a.onSelectPage({page:b}))},a.selectNext=function(){a.noNext()||a.selectPage(a.currentPage+1)},a.selectPrevious=function(){a.noPrevious()||a.selectPage(a.currentPage-1)},a.noPrevious=function(){return 1==a.currentPage},a.noNext=function(){return a.currentPage==a.numPages}}}}),angular.module("chuangplus_mobile.controllers",[]).controller("MB_CompanyListCtrl",["$scope","$http","urls","CsrfService","$routeParams","NoticeService","UserService","ErrorService","$rootScope","$location",function(a,b,c,d,e,f,g,h,i,j){console.log("MB_CompanyListCtrl"),a.company_list={},a.filter_show=!1,a.pagenow=2,a.filter_params="",a.filed_notice="行业/领域",a.scale_notice="公司规模",a.stage={0:"初创",1:"快速发展",2:"成熟"},a.cfield={social:"社交","e-commerce":"电子商务",education:"教育",health_medical:"健康医疗",culture_creativity:"文化创意",living_consumption:"生活消费",hardware:"硬件",O2O:"O2O",others:"其它"},a.ptype={technology:"技术",product:"产品",design:"设计",operate:"运营",marketing:"市场",functions:"职能",others:"其它"},a.position_type={technology:"技术",product:"产品",design:"设计",operate:"运营",marketing:"市场",functions:"职能",others:"其他"},a.filter={field:{social:!1,e_commerce:!1,education:!1,health_medical:!1,culture_creativity:!1,living_consumption:!1,hardware:!1,O2O:!1,others:!1},scale:"-1",search_name:""},a.go_detail=function(a){j.path("/mobile/company/detail").search({company_id:a})},a.filter_all=function(b){for(var c in a.filter.field)a.filter.field[c]=!a.filter.field.all},a.get_company_list=function(){b.get(c.api+"/account/company/list").success(function(b){if(1==b.error.code){a.company_list=b.data,b.page==b.page_number&&(a.pagenow=-23333);for(var c=0;c<a.company_list.length;c++){a.company_list[c].scale_value=a.stage[a.company_list[c].scale],a.company_list[c].field_value=a.cfield[a.company_list[c].field],a.company_list[c].type_value=a.ptype[a.company_list[c].type],a.company_list[c].position_number=a.company_list[c].positions.length,a.company_list[c].position_type_value={};for(var d=0;d<a.company_list[c].position_type.length;d++)a.company_list[c].position_type_value[d]=a.position_type[a.company_list[c].position_type[d]]}i.company_list_page=a.pagenow,i.company_list_filter=a.filter,i.company_list_response=a.company_list}i.loading=!1})},a.refresh_params=function(){a.filed_notice="行业/领域",a.scale_notice="公司规模",a.filter_params="";for(var b in a.filter.field)1==a.filter.field[b]&&(""==a.filter_params?"e_commerce"==b?(a.filter_params="?fields=e-commerce",a.filed_notice="电子商务"):(a.filter_params="?fields="+b,a.filed_notice=a.cfield[b]):("e_commerce"==b?a.filter_params+=",e-commerce":a.filter_params+=","+b,-1==a.filed_notice.indexOf("等")&&(a.filed_notice+=" 等 ")));"-1"!=a.filter.scale&&""!=a.filter.scale&&(a.scale_notice=a.stage[a.filter.scale],""!=a.filter_params?a.filter_params+="&scale="+a.filter.scale:a.filter_params+="?scale="+a.filter.scale);var c="";return c=""==a.filter.search_name||void 0==a.filter.search_name?a.filter_params:""==a.filter_params?a.filter_params+"?text="+a.filter.search_name:a.filter_params+"&text="+a.filter.search_name},void 0!=i.company_list_response?(i.loading=!1,a.company_list=i.company_list_response,a.pagenow=i.company_list_page,a.filter=i.company_list_filter,a.refresh_params()):a.get_company_list(),a.filter_now=-1,a.show_filter=function(b){return a.filter_now==b?void a.hide_filter(b):(a.hide_filter(3-b),$("#filter-content"+b).animate({top:90},"200"),void(a.filter_now=b))},a.hide_filter=function(b){$("#filter-content"+b).animate({top:-400},"200"),a.filter_now=-1},a.submit_filter=function(d){var e=a.refresh_params();a.hide_filter(d),i.loading=!0,i.company_param=e,b.get(c.api+"/account/company/list"+e).success(function(b){if(1==b.error.code){a.company_list=b.data,console.log(b),b.page==b.page_number&&(a.pagenow=-23333);for(var c=0;c<a.company_list.length;c++){a.company_list[c].scale_value=a.stage[a.company_list[c].scale],a.company_list[c].field_value=a.cfield[a.company_list[c].field],a.company_list[c].type_value=a.ptype[a.company_list[c].type],a.company_list[c].position_number=a.company_list[c].positions.length,a.company_list[c].position_type_value={};for(var d=0;d<a.company_list[c].position_type.length;d++)a.company_list[c].position_type_value[d]=a.position_type[a.company_list[c].position_type[d]]}i.company_list_page=a.pagenow,i.company_list_filter=a.filter,i.company_list_response=a.company_list}i.loading=!1})},a.submit_search=function(){if(""!=a.filter.search_name&&void 0!=a.filter.search_name){var d=a.refresh_params();i.loading=!0,b.get(c.api+"/account/company/list"+d).success(function(b){if(1==b.error.code){a.company_list=b.data,b.page==b.page_number&&(a.pagenow=-23333);for(var c=0;c<a.company_list.length;c++){a.company_list[c].scale_value=a.stage[a.company_list[c].scale],a.company_list[c].field_value=a.cfield[a.company_list[c].field],a.company_list[c].type_value=a.ptype[a.company_list[c].type],a.company_list[c].position_number=a.company_list[c].positions.length,a.company_list[c].position_type_value={};for(var d=0;d<a.company_list[c].position_type.length;d++)a.company_list[c].position_type_value[d]=a.position_type[a.company_list[c].position_type[d]]}i.company_list_page=a.pagenow,i.company_list_filter=a.filter,i.company_list_response=a.company_list}i.loading=!1})}else i.loading=!0,b.get(c.api+"/account/company/list"+a.filter_params).success(function(b){if(1==b.error.code){a.company_list=b.data,b.page==b.page_number&&(a.pagenow=-23333);for(var c=0;c<a.company_list.length;c++){a.company_list[c].scale_value=a.stage[a.company_list[c].scale],a.company_list[c].field_value=a.cfield[a.company_list[c].field],a.company_list[c].type_value=a.ptype[a.company_list[c].type],a.company_list[c].position_number=a.company_list[c].positions.length,a.company_list[c].position_type_value={};for(var d=0;d<a.company_list[c].position_type.length;d++)a.company_list[c].position_type_value[d]=a.position_type[a.company_list[c].position_type[d]]}i.company_list_page=a.pagenow,i.company_list_filter=a.filter,i.company_list_response=a.company_list}i.loading=!1})},a.loading=!1,a.load_more_item=function(){if(!(a.pagenow<0)){var d="";""==a.filter_params?""!=a.filter.search_name&&void 0!=a.filter.search_name&&(d="?text="+a.filter.search_name):d=""!=a.filter.search_name&&void 0!=a.filter.search_name?a.filter_params+"&text="+a.filter.search_name:a.filter_params,d+=""!=d?"&page="+a.pagenow:"?page="+a.pagenow,a.more_loading=!0,a.first_load=!1,b.get(c.api+"/account/company/list"+d).success(function(b){if(1==b.error.code){var c=b.data;b.page==b.page_number&&(a.pagenow=-23333);for(var d=0;d<c.length;d++){c[d].scale_value=a.stage[c[d].scale],c[d].field_value=a.cfield[c[d].field],c[d].type_value=a.ptype[c[d].type],c[d].position_number=c[d].positions.length,c[d].position_type_value={};for(var e=0;e<c[d].position_type.length;e++)c[d].position_type_value[e]=a.position_type[c[d].position_type[e]]}a.company_list=a.company_list.concat(c),i.company_list_response=a.company_list,i.company_list_filter=a.filter,a.pagenow++,i.company_list_page=a.pagenow}a.more_loading=!1})}},a.first_load=!0,document.getElementById("scrollable-content").onscroll=function(){i.company_list_position=document.getElementById("scrollable-content").scrollTop},a.$on("ngRepeatFinished",function(b){void 0!=i.company_list_response&&a.first_load&&(document.getElementById("scrollable-content").scrollTop=i.company_list_position)})}]).controller("MB_PositionListCtrl",["$scope","$http","urls","CsrfService","$routeParams","NoticeService","UserService","ErrorService","$rootScope","$location",function(a,b,c,d,e,f,g,h,i,j){console.log("MB_PositionListCtrl"),a.positions={},a.filter_show=!1,a.pagenow=2,a.workdays_notice="工作时间",a.salary_notice="月薪下限",a.filed_notice="行业/领域",a.type_notice="职位类型",a.filter_params="",a.position_type={technology:"技术",product:"产品",design:"设计",operate:"运营",marketing:"市场",functions:"职能",others:"其他"},a.filter={workdays:0,field:{social:!1,e_commerce:!1,education:!1,health_medical:!1,culture_creativity:!1,living_consumption:!1,hardware:!1,O2O:!1,others:!1},type:{technology:!1,product:!1,design:!1,operate:!1,marketing:!1,functions:!1,others:!1},search_name:"",salary:""},a.cfield={social:"社交","e-commerce":"电子商务",education:"教育",health_medical:"健康医疗",culture_creativity:"文化创意",living_consumption:"生活消费",hardware:"硬件",O2O:"O2O",others:"其它"},a.go_detail=function(a){j.path("/mobile/position/detail").search({position_id:a})},a.filter_all=function(b){var c;c=3==b?a.filter.field:a.filter.type;for(var d in c)3==b?a.filter.field[d]=!c.all:a.filter.type[d]=!c.all},a.refresh_params=function(){a.workdays_notice="工作时间",a.salary_notice="月薪下限",a.filed_notice="行业/领域",a.type_notice="职位类型";var b=!1;a.filter_params="";for(var c in a.filter.field)1==a.filter.field[c]&&(""==a.filter_params?"e_commerce"==c?(a.filter_params="?fields=e-commerce",a.filed_notice="电子商务"):(a.filter_params="?fields="+c,a.filed_notice=a.cfield[c]):("e_commerce"==c?a.filter_params+=",e-commerce":a.filter_params+=","+c,-1==a.filed_notice.indexOf("等")&&(a.filed_notice+=" 等 ")));0!=a.filter.workdays?(""==a.filter_params?a.filter_params+="?max_workday="+a.filter.workdays:a.filter_params+="&max_workday="+a.filter.workdays,a.workdays_notice="每周"+a.filter.workdays+"天"):a.workdays_notice="弹性时间",b=!1;for(var c in a.filter.type)1==a.filter.type[c]&&(""==a.filter_params?(a.filter_params="?types="+c,a.type_notice=a.position_type[c]):b?(a.filter_params+=","+c,-1==a.type_notice.indexOf("等")&&(a.type_notice+=" 等 ")):(a.filter_params+="&types="+c,a.type_notice=a.position_type[c]),b=!0);""!=a.filter.salary&&void 0!=a.filter.salary&&(""!=a.filter_params?a.filter_params+="&salary_min="+a.filter.salary:a.filter_params+="?salary_min="+a.filter.salary,a.salary_notice=a.filter.salary+"K");var d="";return d=void 0==a.filter.search_name||""==a.filter.search_name?a.filter_params:""==a.filter_params?"?name="+a.filter.search_name:a.filter_params+"&name="+a.filter.search_name},a.get_positions=function(){b.get(c.api+"/position/search").success(function(b){if(1==b.error.code){a.positions=b.positions,b.page==b.page_number&&(a.pagenow=-23333);for(var c=0;c<a.positions.length;c++)a.positions[c].field_value=a.cfield[a.positions[c].company.field],a.positions[c].position_type_value=a.position_type[a.positions[c].position_type],0==a.positions[c].company.scale?a.positions[c].company.scale_value="初创":1==a.positions[c].company.scale?a.positions[c].company.scale_value="快速发展":a.positions[c].company.scale_value="成熟";i.position_list_page=a.pagenow,i.position_list_filter=a.filter,i.position_list_response=a.positions}else console.log(b.error.message);i.loading=!1})},void 0!=i.position_list_response?(i.loading=!1,a.positions=i.position_list_response,a.pagenow=i.position_list_page,a.filter=i.position_list_filter,a.refresh_params()):a.get_positions(),a.filter_now=-1,a.show_filter=function(b){if(a.filter_now==b)return void a.hide_filter(b);for(var c=4;c>=1;c--)c!=b&&a.hide_filter(c);a.filter_now=b,$("#filter-content"+b).animate({top:90},"200")},a.hide_filter=function(b){$("#filter-content"+b).animate({top:-400},"200"),a.filter_now=-1},a.submit_filter=function(d){var e=!1;a.workdays_notice="工作时间",a.salary_notice="月薪下限",a.filed_notice="行业/领域",a.type_notice="职位类型",a.filter_params=null;for(var f in a.filter.field)1==a.filter.field[f]&&(null==a.filter_params?(a.filed_notice=a.cfield[f],a.filter_params="?fields="+f):a.filter_params+=","+f);0!=a.filter.workdays?(null==a.filter_params?a.filter_params+="?max_workday="+a.filter.workdays:a.filter_params+="&max_workday="+a.filter.workdays,a.workdays_notice="每周"+a.filter.workdays+"天"):a.workdays_notice="弹性时间",e=!1;for(var f in a.filter.type)1==a.filter.type[f]&&(null==a.filter_params?(a.filter_params="?types="+f,a.type_notice=a.position_type[f]):e?a.filter_params+=","+f:(a.filter_params="&types="+f,a.type_notice=a.position_type[f]),e=!0);""!=a.filter.salary&&void 0!=a.filter.salary&&(null!=a.filter_params?a.filter_params+="&salary_min="+a.filter.salary:a.filter_params+="?salary_min="+a.filter.salary,a.salary_notice=a.filter.salary+"K");var g="";g=null==a.filter.search_name||void 0==a.filter.search_name?a.filter_params:null==a.filter_params?"?name="+a.filter.search_name:a.filter_params+"&name="+a.filter.search_name;var g=a.refresh_params();a.hide_filter(d),i.loading=!0,b.get(c.api+"/position/search"+g).success(function(b){if(1==b.error.code){a.positions=b.positions,b.page==b.page_number&&(a.pagenow=-23333);for(var c=0;c<a.positions.length;c++)a.positions[c].field_value=a.cfield[a.positions[c].company.field],a.positions[c].position_type_value=a.position_type[a.positions[c].position_type],0==a.positions[c].company.scale?a.positions[c].company.scale_value="初创":1==a.positions[c].company.scale?a.positions[c].company.scale_value="快速发展":a.positions[c].company.scale_value="成熟";i.position_list_page=a.pagenow,i.position_list_filter=a.filter,i.position_list_response=a.positions}i.loading=!1})},a.reset_search=function(){""==a.filter.search_name&&a.submit_search()},a.submit_search=function(){if(""!=a.filter.search_name&&void 0!=a.filter.search_name){a.filter_params="";var d=!1;for(var e in a.filter.field)1==a.filter.field[e]&&(""==a.filter_params?(a.filed_notice=a.cfield[e],a.filter_params="?fields="+e):a.filter_params+=","+e);0!=a.filter.workdays?(""==a.filter_params?a.filter_params+="?max_workday="+a.filter.workdays:a.filter_params+="&max_workday="+a.filter.workdays,a.workdays_notice="每周"+a.filter.workdays+"天"):a.workdays_notice="弹性时间",d=!1;for(var e in a.filter.type)1==a.filter.type[e]&&(""==a.filter_params?(a.filter_params="?types="+e,a.type_notice=a.position_type[e]):d?a.filter_params+=","+e:(a.filter_params="&types="+e,a.type_notice=a.position_type[e]),d=!0);""!=a.filter.salary&&void 0!=a.filter.salary&&(""!=a.filter_params?a.filter_params+="&salary_min="+a.filter.salary:a.filter_params+="?salary_min="+a.filter.salary,a.salary_notice=a.filter.salary+"K");var f="";f=""==a.filter_params?"?name="+a.filter.search_name:a.filter_params+"&name="+a.filter.search_name,i.loading=!0,b.get(c.api+"/position/search"+f).success(function(b){if(1==b.error.code){a.positions=b.positions,b.page==b.page_number&&(a.pagenow=-23333);for(var c=0;c<a.positions.length;c++)a.positions[c].field_value=a.cfield[a.positions[c].company.field],a.positions[c].position_type_value=a.position_type[a.positions[c].position_type],0==a.positions[c].company.scale?a.positions[c].company.scale_value="初创":1==a.positions[c].company.scale?a.positions[c].company.scale_value="快速发展":a.positions[c].company.scale_value="成熟";i.position_list_response=a.positions,i.position_list_page=a.pagenow,i.position_list_filter=a.filter}i.loading=!1})}else i.loading=!0,b.get(c.api+"/position/search"+a.filter_params).success(function(b){if(1==b.error.code){a.positions=b.positions,b.page==b.page_number&&(a.pagenow=-23333);for(var c=0;c<a.positions.length;c++)a.positions[c].field_value=a.cfield[a.positions[c].company.field],a.positions[c].position_type_value=a.position_type[a.positions[c].position_type],0==a.positions[c].company.scale?a.positions[c].company.scale_value="初创":1==a.positions[c].company.scale?a.positions[c].company.scale_value="快速发展":a.positions[c].company.scale_value="成熟";i.position_list_page=a.pagenow,i.position_list_response=a.positions,i.position_list_filter=a.filter}i.loading=!1})},a.more_loading=!1,a.load_more_item=function(){if(!(a.pagenow<0)){var d="";""==a.filter_params?""!=a.filter.search_name&&void 0!=a.filter.search_name&&(d="?name="+a.filter.search_name):d=""!=a.filter.search_name&&void 0!=a.filter.search_name?a.filter_params+"&name="+a.filter.search_name:a.filter_params,d+=""!=d?"&page="+a.pagenow:"?page="+a.pagenow,a.more_loading=!0,a.first_load=!1,b.get(c.api+"/position/search"+d).success(function(b){if(1==b.error.code){var c=b.positions;b.page==b.page_number&&(a.pagenow=-23333);for(var d=0;d<c.length;d++)c[d].field_value=a.cfield[c[d].company.field],c[d].position_type_value=a.position_type[c[d].position_type],0==c[d].company.scale?c[d].company.scale_value="初创":1==c[d].company.scale?c[d].company.scale_value="快速发展":c[d].company.scale_value="成熟";a.positions=a.positions.concat(c),a.pagenow++,i.position_list_page=a.pagenow,i.position_list_response=a.positions,i.position_list_filter=a.filter}a.more_loading=!1})}},a.first_load=!0,document.getElementById("scrollable-content").onscroll=function(){i.position_list_position=document.getElementById("scrollable-content").scrollTop},a.$on("ngRepeatFinished",function(b){void 0!=i.position_list_response&&a.first_load&&(document.getElementById("scrollable-content").scrollTop=i.position_list_position)})}]).controller("MB_PositionFilterCtrl",["$scope","$http","urls","$routeParams",function(a,b,c,d){}]).controller("MB_CompanyPositionCtrl",["$scope","$http","urls","CsrfService","$routeParams","NoticeService","UserService","ErrorService","$rootScope","$location",function(a,b,c,d,e,f,g,h,i,j){a.get_company=function(){a.company_id=e.company_id,console.log(a.company_id),a.position_type={technology:"技术",product:"产品",design:"设计",operate:"运营",marketing:"市场",functions:"职能",others:"其他"},a.latest_scale={0:"初创",1:"快速发展",2:"成熟"},a.cfield={social:"社交","e-commerce":"电子商务",education:"教育",health_medical:"健康医疗",culture_creativity:"文化创意",living_consumption:"生活消费",hardware:"硬件",O2O:"O2O",others:"其它"},a.company_id=e.company_id,a.go_detail_position=function(a){j.path("/mobile/position/detail").search({position_id:a})},a.go_detail_company=function(){j.path("/mobile/company/detail").search({company_id:a.company_id})},b.get(c.api+"/account/company/"+a.company_id+"/detail_with_positions").success(function(b,c,d,e){if(console.log(b),1==b.error.code){a.company=b.data,a.company.field_value=a.cfield[a.company.field],a.company.scale_value=a.latest_scale[a.company.scale],a.company.position_number=a.company.position_list.length,a.company.position_type_value={};for(var f=0;f<a.company.position_type.length;f++)a.company.position_type_value[f]=a.position_type[a.company.position_type[f]];for(var f=0;f<a.company.position_number;f++)a.company.position_list[f].position_type_value=a.position_type[a.company.position_list[f].position_type]}i.loading=!1})},a.get_company(),a.post_value="收藏公司",a.check_favor_company=function(){b.get(c.api+"/account/userinfo/"+a.company_id+"/check_favor_company").success(function(b){1==b.error.code&&(console.log(b),a.favor_exist=b.data.exist,1==a.favor_exist?a.post_value="取消收藏":a.post_value="收藏公司")})},a.check_favor_company(),a.post=function(){g.is_login()?0==a.favor_exist?(a.param={csrfmiddlewaretoken:d.val()},b.post(c.api+"/account/company/"+a.company_id+"/like",$.param(a.param)).success(function(b){1==b.error.code?(a.post_value="取消收藏",a.favor_exist=!0,f.show("已收藏")):f.show(h.format_error("",udata.error).message)})):(a.param={csrfmiddlewaretoken:d.val()},b.post(c.api+"/account/company/"+a.company_id+"/unlike",$.param(a.param)).success(function(b){1==b.error.code?(a.post_value="收藏公司",a.favor_exist=!1,f.show("已取消收藏")):f.show(h.format_error("",udata.error).message)})):f.show("请先登录")}}]).controller("MB_CompanyDetailCtrl",["$scope","$http","urls","CsrfService","$routeParams","NoticeService","UserService","ErrorService","$rootScope","$location",function(a,b,c,d,e,f,g,h,i,j){a.company_id=e.company_id,console.log("MB_CompanyDetailCtrl "+a.company_id),a.company={},a.latest_scale={0:"初创",1:"快速发展",2:"成熟"},a.cfield={social:"社交","e-commerce":"电子商务",education:"教育",health_medical:"健康医疗",culture_creativity:"文化创意",living_consumption:"生活消费",hardware:"硬件",O2O:"O2O",others:"其它"},a.position_type={technology:"技术",product:"产品",design:"设计",operate:"运营",marketing:"市场",functions:"职能",others:"其他"},a.stage={seed:"种子轮",angel:"天使轮",A:"A轮",B:"B轮",C:"C轮",D_plus:"D及以上轮"},a.amount={ten:"十万级",hundred:"百万级",thousand:"千万级",thousand_plus:"亿级"},a.get_company=function(){b.get(c.api+"/account/company/"+a.company_id+"/detail_with_positions").success(function(d){if(1==d.error.code){a.company=d.data,console.log(a.company.position_type),a.company.field_value=a.cfield[a.company.field],a.company.scale_value=a.latest_scale[a.company.scale],a.company.position_type_value={};for(var e=0;e<a.company.position_type.length;e++)a.company.position_type_value[e]=a.position_type[a.company.position_type[e]];-1==a.company.homepage.indexOf("http://")&&-1==a.company.homepage.indexOf("https://")&&(a.company.homepage="http://"+a.company.homepage),b.get(c.api+"/account/financing/"+a.company_id+"/list").success(function(b){if(1==d.error.code){a.company.financing_data=b.data,a.company.financing_number=b.data.length;for(var c=0;c<a.company.financing_number;c++)a.company.financing_data[c].organization=a.company.financing_data[c].organization,a.company.financing_data[c].scale_value=a.stage[a.company.financing_data[c].stage],a.company.financing_data[c].amount_value=a.amount[a.company.financing_data[c].amount]}}),b.get(c.api+"/account/member/"+a.company_id+"/list").success(function(b){1==b.error.code&&(a.member_list=b.data,a.member_number=b.data.length),i.loading=!1})}})},a.get_company(),a.post_value="收藏公司",a.check_favor_company=function(){b.get(c.api+"/account/userinfo/"+a.company_id+"/check_favor_company").success(function(b){1==b.error.code&&(console.log(b),a.favor_exist=b.data.exist,1==a.favor_exist?a.post_value="取消收藏":a.post_value="收藏公司")})},a.check_favor_company(),a.post=function(){g.is_login()?0==a.favor_exist?(a.param={csrfmiddlewaretoken:d.val()},b.post(c.api+"/account/company/"+a.company_id+"/like",$.param(a.param)).success(function(b){1==b.error.code?(a.post_value="取消收藏",a.favor_exist=!0,f.show("已收藏")):f.show(h.format_error("",udata.error).message)})):(a.param={csrfmiddlewaretoken:d.val()},b.post(c.api+"/account/company/"+a.company_id+"/unlike",$.param(a.param)).success(function(b){1==b.error.code?(a.post_value="收藏公司",a.favor_exist=!1,f.show("已取消收藏")):f.show(h.format_error("",udata.error).message)})):f.show("请先登录")}}]).controller("MB_PositionDetailCtrl",["$scope","$http","urls","CsrfService","$routeParams","NoticeService","UserService","ErrorService","$rootScope","$location",function(a,b,c,d,e,f,g,h,i,j){a.position_id=e.position_id,console.log(a.position_id),a.latest_scale={0:"初创",1:"快速发展",2:"成熟"},a.cfield={social:"社交","e-commerce":"电子商务",education:"教育",health_medical:"健康医疗",culture_creativity:"文化创意",living_consumption:"生活消费",hardware:"硬件",O2O:"O2O",others:"其它"},a.position_type={technology:"技术",product:"产品",design:"设计",operate:"运营",marketing:"市场",functions:"职能",others:"其他"},a.post_value="收藏职位",a.go_detail=function(){j.path("/mobile/company/detail").search({company_id:a.position.company._id.$oid})},b.get(c.api+"/position/"+a.position_id+"/get_with_company").success(function(d){1==d.error.code?(a.position=d.data,a.position.scale_value=a.latest_scale[a.position.company.scale],a.position.field_value=a.cfield[a.position.company.field],a.position.position_type_value=a.position_type[a.position.position_type],a.position.position_number=a.position.company.position_list.length,b.get(c.api+"/account/company/"+a.position.company._id.$oid+"/detail_with_positions").success(function(b){if(console.log(b),1==b.error.code){a.position.company.position_type_value={};for(var c=0;c<b.data.position_type.length;c++)a.position.company.position_type_value[c]=a.position_type[b.data.position_type[c]]}else console.log(b.error.message);i.loading=!1})):console.log(d.error.message)}),b.get(c.api+"/account/userinfo/"+a.position_id+"/check_favor_position").success(function(b){console.log(b),1==b.error.code?(a.favor_exist=b.data.exist,1==a.favor_exist?a.post_value="取消收藏":a.post_value="收藏职位"):console.log(b.error.message);
}),a.post=function(){g.is_login()?0==a.favor_exist?(a.submitFavor={},a.submitFavor.position_id=a.position_id,d.set_csrf(a.submitFavor),b.post(c.api+"/position/"+a.position_id+"/userlikeposition",$.param(a.submitFavor)).success(function(b){a.post_value="取消收藏",a.favor_exist=!0})):(a.submitUnFavor={},a.submitUnFavor.position_id=a.position_id,d.set_csrf(a.submitUnFavor),b.post(c.api+"/position/"+a.position_id+"/userunlikeposition",$.param(a.submitUnFavor)).success(function(b){a.post_value="收藏职位",a.favor_exist=!1})):f.show("请先登录")},a.userinfo={},b.get(c.api+"/account/userinfo/get").success(function(b){1==b.error.code?(a.userinfo=b.data,a.submitResume={},a.submitResume.position_id=a.position_id,console.log(a.userinfo.resume_id),void 0!=a.userinfo.real_name&&null!=a.userinfo.real_name&&""!=a.userinfo.real_name?a.resume_compelete=!0:a.resume_compelete=!1,void 0!=a.userinfo.resume_id&&null!=a.userinfo.resume_id?a.resume_submitted=!0:a.resume_submitted=!1):console.log(h.format_error("",b.error).message)}),a.is_submit="投简历",b.get(c.api+"/position/"+a.position_id+"/check_submit").success(function(b){1==b.error.code&&b.exist&&(a.is_submit="已投递")}),a.submit_posi=function(){1==a.resume_submitted?a.submitResume.resume_choice=1:a.submitResume.resume_choice=3,a.resume_compelete&&(d.set_csrf(a.submitResume),b.post(c.api+"/position/"+a.position_id+"/submit",$.param(a.submitResume)).success(function(b){1==b.error.code?(a.is_submit="已投递",f.show("投递成功")):f.show(h.format_error("",b.error).message)}))},a.notice=function(a){f.show(a)},a.complete_resume=function(){setTimeout(function(){window.location.href="/intern/resume"},2e3)}}]).controller("MB_LoginCtrl",["$scope","$http","urls","CsrfService","$routeParams","NoticeService","UserService","ErrorService","$rootScope","$location",function(a,b,c,d,e,f,g,h,i,j){console.log("MB_LoginCtrl"),a.captcha_url=c.api+"/captcha/image/",a.login_info={},a.capcha_info={},a.refresh_captcha=function(){a.captcha_url=c.api+"/captcha/image/?"+Math.random()},a.is_captcha_ok=0,i.tsinghua_occu="0",a.check_captcha=function(){d.set_csrf(a.capcha_info),a.capcha_info.captcha=a.login_info.captcha,console.log(a.login_info.captcha),b.post(c.api+"/captcha/check/",$.param(a.capcha_info)).success(function(b){return"yes"!=b?(f.show("验证码错误"),$("#captcha-pass").hide(),a.is_captcha_ok=0,!1):($("#captcha-pass").show(),a.is_captcha_ok=1,!0)})},a.login_user=function(){console.log(a.is_captcha_ok),d.set_csrf(a.login_info),console.log(a.login_info),1!=a.is_tsinghua?b.post(c.api+"/account/login",$.param(a.login_info)).success(function(a){console.log(a),1==a.error.code?(i.is_tsinghua=!1,1==a.completive?void 0!=i.login_url?window.location.href=i.login_url:window.location.href=c.mobile_index:window.location.href="/mobile/info"):f.show(h.format_error("",a.error).message)}):b.post(c.api+"/account/login_by_tsinghua",$.param(a.login_info)).success(function(a){console.log(a),1==a.error.code?(i.is_tsinghua=!0,1==a.completive?void 0!=i.login_url?window.location.href=i.login_url:window.location.href=c.mobile_index:window.location.href="/mobile/info"):32==a.error.code?(console.log("存在"),i.tsinghua_occu="1",i.student_id=a.student_id,j.path("/mobile/info")):f.show(h.format_error("",a.error).message)})},a.refresh_captcha(),i.loading=!1}]).controller("MB_RegisterCtrl",["$scope","$http","urls","CsrfService","$routeParams","NoticeService","UserService","ErrorService","$rootScope",function(a,b,c,d,e,f,g,h,i){console.log("MB_RegisterCtrl"),a.info_check=[0,0,0,0],a.reg_info={},a.capcha_info={},a.captcha_url=c.api+"/captcha/image/",a.check_username={},a.e_check={},a.refresh_captcha=function(){a.captcha_url=c.api+"/captcha/image/?"+Math.random()},a.check_captcha=function(){d.set_csrf(a.capcha_info),a.capcha_info.captcha=a.reg_info.captcha,console.log(a.reg_info.captcha),b.post(c.api+"/captcha/check/",$.param(a.capcha_info)).success(function(b){return"yes"!=b?(f.show("验证码错误"),$("#captcha-pass").hide(),a.info_check[3]=0,!1):($("#captcha-pass").show(),a.info_check[3]=1,!0)})},a.check_username=function(){return a.check_username.username=a.reg_info.username,d.set_csrf(a.check_username),a.check_username.username.length>5?(b.post(c.api+"/account/checkusername",$.param(a.check_username)).success(function(b){if(1==b.error.code){if(console.log(b),"false"!=b.username.exist)return f.show("用户名已存在"),$("#username-pass").hide(),a.info_check[0]=0,!1;$("#username-pass").show()}}),a.info_check[0]=1,!0):(f.show("用户名长度最短6位"),a.info_check[0]=0,!1)},a.check_email=function(){return a.e_check.email=a.reg_info.email,d.set_csrf(a.e_check),console.log(a.reg_info.email),void 0==a.reg_info.email?(f.show("请输入合法的邮箱地址"),$("#email-pass").hide(),a.info_check[1]=0,!1):(b.post(c.api+"/account/checkemail",$.param(a.e_check)).success(function(b){return 1==b.error.code&&(console.log(b),"false"!=b.email.exist)?(f.show("该邮箱已使用"),$("#email-pass").hide(),a.info_check[1]=0,!1):void 0}),$("#email-pass").show(),a.info_check[1]=1,!0)},a.check_pass_len=function(){return void 0==a.reg_info.password?(f.show("为保证安全，密码最少为6位"),$("#pass1-pass").hide(),a.info_check[2]=0,!1):($("#pass1-pass").show(),a.info_check[2]=1,!0)},a.check_pass_same=function(){return a.reg_info.password!=a.repeate_password&&void 0!=a.reg_info.password?(f.show("两次输入密码需一致"),$("#pass2-pass").hide(),a.info_check[2]=0,!1):($("#pass2-pass").show(),a.info_check[2]=1,!0)},a.refresh_captcha(),a.info_check_flist=[a.check_username,a.check_email,a.check_pass_len,a.check_pass_same,a.check_captcha],a.register=function(){var e=0;a.check_username()&&a.check_email()&&a.check_pass_len()&&a.check_pass_same()&&a.check_captcha()&&(e=4);for(var g=a.info_check.length-1;g>=0;g--)e+=a.info_check[g];4==e&&(console.log(a.reg_info),d.set_csrf(a.reg_info),b.post(c.api+"/account/register",$.param(a.reg_info)).success(function(a){1==a.error.code?setTimeout(window.location.href="/mobile/info",1e3):f.show(h.format_error("",a.error).message)}))},i.loading=!1}]).controller("MB_PositionFavorCtrl",["$scope","$http","urls","CsrfService","$routeParams","NoticeService","UserService","ErrorService","$rootScope","$location",function(a,b,c,d,e,f,g,h,i,j){console.log("MB_PositionFavorCtrl"),g.check_login(),a.positions={},a.position_type={technology:"技术",product:"产品",design:"设计",operate:"运营",marketing:"市场",functions:"职能",others:"其他"},a.cfield={social:"社交","e-commerce":"电子商务",education:"教育",health_medical:"健康医疗",culture_creativity:"文化创意",living_consumption:"生活消费",hardware:"硬件",O2O:"O2O",others:"其它"},a.go_detail=function(a){j.path("/mobile/position/detail").search({position_id:a})},a.setPostIndex=function(b){a.postIndex=b,a.nowPosition=a.positions[b]},a.get_userInfo=function(){a.userinfo={},b.get(c.api+"/account/userinfo/get").success(function(b){console.log(b),1==b.error.code?(a.userinfo=b.data,a.submitResume={},a.submitResume.position_id=a.position_id,console.log(a.userinfo.resume_id),void 0!=a.userinfo.real_name&&null!=a.userinfo.real_name&&""!=a.userinfo.real_name?a.resume_compelete=!0:a.resume_compelete=!1,void 0!=a.userinfo.resume_id&&null!=a.userinfo.resume_id?(a.submitResume.resume_choice=1,a.resume_submitted=!0,console.log("here")):a.resume_submitted=!1):console.log(b.error).message})},a.get_positions=function(){b.get(c.api+"/account/userinfo/position/favor/list").success(function(b){if(console.log(b),1==b.error.code){a.positions=b.data;for(var c=0;c<a.positions.length;c++)a.positions[c].position_type_value=a.position_type[a.positions[c].position_type],a.positions[c].field_value=a.cfield[a.positions[c].company.field],0==a.positions[c].company.scale?a.positions[c].company.scale_value="初创":1==a.positions[c].company.scale?a.positions[c].company.scale_value="快速发展":a.positions[c].company.scale_value="成熟"}else console.log(b.error.message);i.loading=!1})},a.check_submit=function(d){b.get(c.api+"/position/"+a.positions[d]._id.$oid+"/check_submit").success(function(b){1==b.error.code?1==b.exist?a.positions[d].resume_submitted=!0:($index,a.positions[d].resume_submitted=!1):console.log(b.error.message)})},a.get_userInfo(),a.get_positions(),a.submit_posi=function(e){1==a.resume_submitted?a.submitResume.resume_choice=1:a.submitResume.resume_choice=3,a.resume_compelete&&(d.set_csrf(a.submitResume),b.post(c.api+"/position/"+a.positions[e]._id.$oid+"/submit",$.param(a.submitResume)).success(function(b){1==b.error.code?(f.show("已投递"),a.positions[e].resume_submitted=!0):f.show(h.format_error("",b.error).message)}))},a.submit_all=function(){a.resume_compelete&&(a.submitResume={},d.set_csrf(a.submitResume),b.post(c.api+"/account/userinfo/position/favor/submitall",$.param(a.submitResume)).success(function(b){if(1==b.error.code){a.submit_value="已投递",f.show("全部投递成功");for(var c=0;c<a.positions.length;c++)a.positions[c].resume_submitted=!0}else f.show(h.format_error("",b.error).message)}))},a.clear_invalid=function(){a.submitResume={},d.set_csrf(a.submitResume),b.post(c.api+"/account/userinfo/remove/closed_position",$.param(a.submitResume)).success(function(a){1==a.error.code?window.location.href="/mobile/position/collect":f.show(h.format_error("",a.error).message)})}}]).controller("MB_CompanyFavorCtrl",["$scope","$http","urls","CsrfService","$routeParams","NoticeService","UserService","ErrorService","$rootScope","$location",function(a,b,c,d,e,f,g,h,i,j){g.check_login(),a.company_list={},a.position_type={technology:"技术",product:"产品",design:"设计",operate:"运营",marketing:"市场",functions:"职能",others:"其他"},a.position_index={technology:0,product:1,design:2,operate:3,marketing:4,functions:5,others:6},a.scale={0:"初创",1:"快速发展",2:"成熟"},a.cfield={social:"社交","e-commerce":"电子商务",education:"教育",health_medical:"健康医疗",culture_creativity:"文化创意",living_consumption:"生活消费",hardware:"硬件",O2O:"O2O",others:"其它"},a.go_detail=function(a){j.path("/mobile/company/detail").search({company_id:a})},a.get_company_list=function(){b.get(c.api+"/account/userinfo/company/favor/list").success(function(b){if(1==b.error.code){a.company_list=b.data,a.company_num=a.company_list.length;for(var c=0;c<a.company_list.length;c++){a.company_list[c].field_value=a.cfield[a.company_list[c].field],a.company_list[c].position_number=a.company_list[c].positions.length,a.company_list[c].position_types={},a.company_list[c].scale_value=a.scale[a.company_list[c].scale];for(var d=0;d<a.company_list[c].positions.length;d++)a.company_list[c].position_types[a.position_index[a.company_list[c].positions[d].position_type]]=a.position_type[a.company_list[c].positions[d].position_type]}}else a.error=h.format_error("",b.error);i.loading=!1})},a.get_company_list()}]).controller("MB_EditResumeCtrl",["$scope","$http","urls","CsrfService","$routeParams","NoticeService","UserService","ErrorService","$rootScope",function(a,b,c,d,e,f,g,h,i){console.log("MB_EditResumeCtrl"),g.check_login(),a.position_id=e.position_id,a.filename="无简历附件",a.intern_info={},a.get_intern_info=function(){b.get(c.api+"/account/userinfo/get").success(function(b){1==b.error.code?(a.intern_info=b.data,void 0!=a.intern_info.resume_name&&void 0!=a.intern_info.resume_id&&(a.filename=a.intern_info.resume_name)):a.error=h.format_error("",b.error),i.loading=!1})},a.get_intern_info(),a.save_intern_info=function(){void 0!=a.intern_info.real_name&&void 0!=a.intern_info.description&&void 0!=a.intern_info.gender&&void 0!=a.intern_info.cellphone&&void 0!=a.intern_info.work_days?(d.set_csrf(a.intern_info),b.post(c.api+"/account/userinfo/set",$.param(a.intern_info)).success(function(b){1==b.error.code?(f.show("修改简历成功"),void 0!=a.position_id?window.location.href="/mobile/position/detail/"+a.position_id:setTimeout("window.location.href='/mobile/home'",1800)):f.show(h.format_error("",b.error).message)})):f.show("请填写合法的内容")},a.upload=function(b,e){var f={file_type:e,description:g.username(),category:g.username()+"_"+e},i={"X-CSRFToken":d.val(),"Content-Type":b.type};Upload.upload({url:c.api+"/file/upload",data:f,headers:i,file:b}).progress(function(b){var c=parseInt(100*b.loaded/b.total);a.progress="progress: "+c+"% "+b.config.file.name}).success(function(b,c,d,e){1==b.error.code?(a.intern_info.resume_name=e.file.name,console.log("file "+e.file.name+"uploaded. Response: "+b.data),a.intern_info.resume_id=b.data,a.filename=e.file.name):(console.log(b.error.message),a.error=h.format_error("",b.error))})}}]).controller("MB_UserInfoUpdateCtrl",["$scope","$http","urls","CsrfService","$routeParams","NoticeService","UserService","ErrorService","$rootScope",function(a,b,c,d,e,f,g,h,i){console.log("MB_UserInfoUpdateCtrl"),g.check_login(),a.info={},a.tab_now=2,a.user_info={},a.user_pwd={},a.info.username=g.username(),a.e_check={},b.get(c.api+"/account/userinfo/get").success(function(b){1==b.error.code&&(a.user_info=b.data,i.loading=!1)}),a.check_pass_len=function(){return void 0==a.user_pwd.new_password?(f.show("为保证安全，密码最少为6位"),$("#pass1-pass").hide(),a.info_check=0,!1):($("#pass1-pass").show(),a.info_check=1,!0)},a.check_pass_same=function(){return a.user_pwd.new_password!=a.repeate_password&&void 0!=a.user_pwd.new_password?(f.show("两次输入密码需一致"),$("#pass2-pass").hide(),a.info_check=0,!1):($("#pass2-pass").show(),a.info_check=1,!0)},a.update_info=function(){void 0!=a.user_info.email&&void 0!=a.user_info.major&&void 0!=a.user_info.university?(d.set_csrf(a.user_info),b.post(c.api+"/account/userinfo/set",$.param(a.user_info)).success(function(a){1==a.error.code?(f.show("修改信息成功"),setTimeout(window.location.href="/mobile/home",500)):f.show(h.format_error("",a.error).message)})):f.show("请填写合法的信息")},a.update_password=function(){1==a.info_check&&(d.set_csrf(a.user_pwd),b.post(c.api+"/account/password/set",$.param(a.user_pwd)).success(function(a){console.log(a.message),1==a.error.code?(f.show("修改密码成功"),setTimeout(window.location.href="/mobile/home",500)):f.show(h.format_error("",a.error).message)}))}}]).controller("MB_LeftSidebarCtrl",["$scope","$http","urls","CsrfService","$routeParams","NoticeService","UserService","ErrorService","$rootScope",function(a,b,c,d,e,f,g,h,i){console.log(g.username()),a.is_login=void 0!=g.username()&&""!=g.username(),a.username=g.username(),a.logout=function(){console.log("logout"),b.get(c.api+"/account/logout").success(function(a){console.log(a),1==a.error.code&&(g.logout(),window.location.href="/mobile/index")})}}]).controller("MB_UserInfoEditCtrl",["$scope","$http","urls","CsrfService","$routeParams","NoticeService","UserService","ErrorService","$rootScope","$location",function(a,b,c,d,e,f,g,h,i,j){console.log("MB_UserInfoEditCtrl"),void 0==g.username&&(window.location.href="/mobile/login"),a.info={},a.user_info={},a.info.username=g.username(),a.tsinghua_occu="1"==i.tsinghua_occu,a.tsinghua_occu?(a.user_info.student_id=i.student_id,i.loading=!1,a.user_info.university="清华大学",i.is_tsinghua=!0,a.is_tsinghua_local=i.is_tsinghua):b.get(c.api+"/account/userinfo/get").success(function(b){1==b.error.code&&(i.is_tsinghua=b.data.is_info,a.is_tsinghua_local=i.is_tsinghua,a.user_info.major=b.data.major,a.user_info.university=b.data.university,a.user_info.grade=b.data.grade,a.user_info.email=b.data.email,a.is_tsinghua_local&&(a.user_info.university="清华大学"),i.loading=!1)}),a.check_username={},a.check_username=function(){a.check_username.username=a.user_info.username,d.set_csrf(a.check_username),a.check_username.username.length>5?b.post(c.api+"/account/checkusername",$.param(a.check_username)).success(function(b){1==b.error.code&&(console.log(b),"false"!=b.username.exist&&(f.show("用户名已存在"),a.info_check=0))}):(f.show("用户名长度最短6位"),a.info_check=0),a.info_check=1},a.update_info=function(){i.is_tsinghua?void 0!=a.user_info.major&&void 0!=a.user_info.university&&void 0!=a.user_info.grade&&(i.is_tsinghua&&void 0!=a.user_info.email||!i.is_tsinghua)?(d.set_csrf(a.user_info),a.tsinghua_occu?1==a.info_check?b.post(c.api+"/account/userinfo/set_username_by_tsinghua",$.param(a.user_info)).success(function(a){1==a.error.code?void 0!=i.login_url?window.location.href=i.login_url:window.location.href=c.mobile_index:f.show(h.format_error("",a.error).message)}):f.show("请填写合法的信息"):b.post(c.api+"/account/userinfo/set_by_tsinghua",$.param(a.user_info)).success(function(a){1==a.error.code?void 0!=i.login_url?window.location.href=i.login_url:window.location.href=c.mobile_index:f.show(h.format_error("",a.error).message)})):f.show("请填写合法的信息"):void 0!=a.user_info.major&&void 0!=a.user_info.university&&void 0!=a.user_info.grade?(d.set_csrf(a.user_info),b.post(c.api+"/account/userinfo/set",$.param(a.user_info)).success(function(a){1==a.error.code?void 0!=i.login_url?window.location.href=i.login_url:window.location.href=c.mobile_index:f.show(h.format_error("",a.error).message)})):f.show("请填写合法的信息")}}]).controller("MB_PostListCtrl",["$scope","$http","urls","CsrfService","$routeParams","NoticeService","UserService","ErrorService","$rootScope","$location",function(a,b,c,d,e,f,g,h,i,j){console.log("MB_PostListCtrl"),g.check_login(),a.positions={},a.position_type={technology:"技术",product:"产品",design:"设计",operate:"运营",marketing:"市场",functions:"职能",others:"其他"},a.position_condition={open:"职位在招",closed:"职位关闭"},a.cfield={social:"社交","e-commerce":"电子商务",education:"教育",health_medical:"健康医疗",culture_creativity:"文化创意",living_consumption:"生活消费",hardware:"硬件",O2O:"O2O",others:"其它"},a.is_processed={"true":"HR已处理","false":"HR未处理"},a.go_detail=function(a){j.path("/mobile/position/detail").search({position_id:a})},a.get_positions=function(){b.get(c.api+"/account/userinfo/position/submit/list").success(function(b){if(1==b.error.code){a.positions=b.data;for(var c=0;c<a.positions.length;c++)a.positions[c].field_value=a.cfield[a.positions[c].company.field],a.positions[c].is_processed=a.is_processed[a.positions[c].processed],a.positions[c].position_cond=a.position_condition[a.positions[c].status],a.positions[c].position_type_value=a.position_type[a.positions[c].position_type],0==a.positions[c].company.scale?a.positions[c].company.scale_value="初创":1==a.positions[c].company.scale?a.positions[c].company.scale_value="快速发展":a.positions[c].company.scale_value="成熟",a.positions[c].submit_value="投递简历"}else console.log(b.error.message);i.loading=!1})},a.get_positions()}]).controller("MB_NotLoginCtrl",["$scope","$http","urls","CsrfService","$routeParams","NoticeService","UserService","ErrorService","$rootScope",function(a,b,c,d,e,f,g,h,i){console.log("MB_NotLoginCtrl"),setTimeout(function(){window.location.href="/mobile/login"},2e3)}]).controller("MB_HomeCenterCtrl",["$scope","$http","urls","CsrfService","$routeParams","NoticeService","UserService","ErrorService","$rootScope",function(a,b,c,d,e,f,g,h,i){i.loading=!1}]).controller("MB_ResizeImgCtrl",["$scope","$http","urls","CsrfService","$routeParams","NoticeService","UserService","ErrorService","$rootScope",function(a,b,c,d,e,f,g,h,i){i.loading=!1;var j=function(a){var b,c=new Image,a=$(a).get(0),d={},e=!1,f=60,g=60,h=800,i=900,j=document.createElement("canvas"),k=function(){c.src=a.src,$(a).wrap('<div class="resize-container"></div>').before('<span class="resize-handle resize-handle-nw"></span>').before('<span class="resize-handle resize-handle-ne"></span>').after('<span class="resize-handle resize-handle-se"></span>').after('<span class="resize-handle resize-handle-sw"></span>'),b=$(a).parent(".resize-container"),b.on("mousedown touchstart",".resize-handle",l),b.on("mousedown touchstart","img",q),$(".js-crop").on("click",t)},l=function(a){a.preventDefault(),a.stopPropagation(),n(a),$(document).on("mousemove touchmove",o),$(document).on("mouseup touchend",m)},m=function(a){a.preventDefault(),$(document).off("mouseup touchend",m),$(document).off("mousemove touchmove",o)},n=function(a){d.container_width=b.width(),d.container_height=b.height(),d.container_left=b.offset().left,d.container_top=b.offset().top,d.mouse_x=(a.clientX||a.pageX||a.originalEvent.touches[0].clientX)+$(window).scrollLeft(),d.mouse_y=(a.clientY||a.pageY||a.originalEvent.touches[0].clientY)+$(window).scrollTop(),"undefined"!=typeof a.originalEvent.touches&&(d.touches=[],$.each(a.originalEvent.touches,function(a,b){d.touches[a]={},d.touches[a].clientX=0+b.clientX,d.touches[a].clientY=0+b.clientY})),d.evnt=a},o=function(a){var j,k,l,m,n={};b.offset();n.x=(a.clientX||a.pageX||a.originalEvent.touches[0].clientX)+$(window).scrollLeft(),n.y=(a.clientY||a.pageY||a.originalEvent.touches[0].clientY)+$(window).scrollTop(),$(d.evnt.target).hasClass("resize-handle-se")?(j=n.x-d.container_left,k=n.y-d.container_top,l=d.container_left,m=d.container_top):$(d.evnt.target).hasClass("resize-handle-sw")?(j=d.container_width-(n.x-d.container_left),k=n.y-d.container_top,l=n.x,m=d.container_top):$(d.evnt.target).hasClass("resize-handle-nw")?(j=d.container_width-(n.x-d.container_left),k=d.container_height-(n.y-d.container_top),l=n.x,m=n.y,(e||a.shiftKey)&&(m=n.y-(j/c.width*c.height-k))):$(d.evnt.target).hasClass("resize-handle-ne")&&(j=n.x-d.container_left,k=d.container_height-(n.y-d.container_top),l=d.container_left,m=n.y,(e||a.shiftKey)&&(m=n.y-(j/c.width*c.height-k))),(e||a.shiftKey)&&(k=j/c.width*c.height),j>f&&k>g&&h>j&&i>k&&(p(j,k),b.offset({left:l,top:m}))},p=function(b,d){j.width=b,j.height=d,j.getContext("2d").drawImage(c,0,0,b,d),$(a).attr("src",j.toDataURL("image/png"))},q=function(a){a.preventDefault(),a.stopPropagation(),n(a),$(document).on("mousemove touchmove",s),$(document).on("mouseup touchend",r)},r=function(a){a.preventDefault(),$(document).off("mouseup touchend",r),$(document).off("mousemove touchmove",s)},s=function(a){var c,e={};if(a.preventDefault(),a.stopPropagation(),c=a.originalEvent.touches,e.x=(a.clientX||a.pageX||c[0].clientX)+$(window).scrollLeft(),e.y=(a.clientY||a.pageY||c[0].clientY)+$(window).scrollTop(),b.offset({left:e.x-(d.mouse_x-d.container_left),top:e.y-(d.mouse_y-d.container_top)}),d.touches&&d.touches.length>1&&c.length>1){var f=d.container_width,g=d.container_height,h=d.touches[0].clientX-d.touches[1].clientX;h*=h;var i=d.touches[0].clientY-d.touches[1].clientY;i*=i;var j=Math.sqrt(h+i);h=a.originalEvent.touches[0].clientX-c[1].clientX,h*=h,i=a.originalEvent.touches[0].clientY-c[1].clientY,i*=i;var k=Math.sqrt(h+i),l=k/j;f*=l,g*=l,p(f,g)}},t=function(){var c,d=$(".overlay").offset().left-b.offset().left,e=$(".overlay").offset().top-b.offset().top,f=$(".overlay").width(),g=$(".overlay").height();c=document.createElement("canvas"),c.width=f,c.height=g,c.getContext("2d").drawImage(a,d,e,f,g,0,0,f,g),window.open(c.toDataURL("image/png"));var h=c.toDataURL();h=h.split(",")[1],h=window.atob(h);for(var i=new Uint8Array(h.length),j=0;j<h.length;j++)i[j]=h.charCodeAt(j);new Blob([i],{type:"image/png"})};k()};j($(".resize-image"))}]);